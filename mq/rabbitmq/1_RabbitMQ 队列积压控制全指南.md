
# RabbitMQ é˜Ÿåˆ—ç§¯å‹æ§åˆ¶å…¨æŒ‡å—ï¼šx-max-length ä¸ºä½•è®¾ç½®æ— æ•ˆï¼Ÿå¦‚ä½•æ­£ç¡®ä½¿ç”¨ï¼Ÿ

> **æœ¬æ–‡æ•™ä½ å¦‚ä½•çœŸæ­£è®© RabbitMQ é˜Ÿåˆ—â€œä¸çˆ†ä»“â€â€”â€”ä»åŸç†ã€é™·é˜±åˆ°å®æˆ˜ï¼Œä¸€æ–‡è®²é€ã€‚**

åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒRabbitMQ æ˜¯æ¶ˆæ¯è§£è€¦çš„åŸºçŸ³ã€‚ä½†å½“æ¶ˆè´¹è€…å®•æœºã€å¤„ç†ç¼“æ…¢æˆ–ç½‘ç»œæŠ–åŠ¨æ—¶ï¼Œé˜Ÿåˆ—æ¶ˆæ¯ä¼šç–¯ç‹‚å †ç§¯ï¼Œè½»åˆ™æ‹–æ…¢ç³»ç»Ÿï¼Œé‡åˆ™å¯¼è‡´ RabbitMQ æœåŠ¡å´©æºƒã€‚  
å¾ˆå¤šäººä»¥ä¸ºè®¾ç½® `x-max-length: 1000` å°±èƒ½â€œè‡ªåŠ¨é™æµâ€ï¼Œç»“æœå‘ç°æ¶ˆæ¯è¿˜æ˜¯æ¶¨åˆ°ä¸Šä¸‡æ¡â€”â€”**è¿™ä¸æ˜¯ Bugï¼Œæ˜¯ä½ è¸©ä¸­äº† RabbitMQ æœ€éšè”½çš„â€œè®¾è®¡é™·é˜±â€**ã€‚

æœ¬æ–‡å°†ä»åŸç†ã€è¯¯åŒºã€éªŒè¯æ–¹æ³•åˆ°æœ€ä½³å®è·µï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ **çœŸæ­£æ§åˆ¶é˜Ÿåˆ—ç§¯å‹**ï¼Œé¿å…ç”Ÿäº§äº‹æ•…ã€‚

---

## 1. ä¸ºä»€ä¹ˆéœ€è¦é™åˆ¶é˜Ÿåˆ—ç§¯å‹ï¼Ÿ

### 1.1 æ¶ˆæ¯å †ç§¯çš„ä¸‰å¤§é£é™©

#### 1.1.1 å†…å­˜è€—å°½ï¼šæœåŠ¡å¡æ­»
RabbitMQ é»˜è®¤å°†æ¶ˆæ¯å…ˆç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚å¦‚æœæ¶ˆè´¹ç«¯é•¿æ—¶é—´ä¸å¤„ç†ï¼Œç§¯å‹æ•°æŒç»­å¢é•¿ï¼Œå†…å­˜å ç”¨ä¼šé£™å‡ã€‚  
å½“å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡ 40%ï¼ˆé»˜è®¤é˜ˆå€¼ï¼‰ï¼ŒRabbitMQ ä¼šè§¦å‘ **memory alarm**ï¼Œè‡ªåŠ¨é˜»å¡æ‰€æœ‰ç”Ÿäº§è€…ï¼Œå¯¼è‡´ä½ çš„ä¸šåŠ¡ç³»ç»Ÿâ€œæ— æ³•å‘æ¶ˆæ¯â€ï¼Œä½†**ä¸ä¼šå´©æºƒ**â€”â€”è¿™æ¯”å´©æºƒæ›´å¯æ€•ï¼š**ä¸šåŠ¡é™é»˜å¤±è´¥**ã€‚

#### 1.1.2 ç£ç›˜çˆ†æ»¡ï¼šæœåŠ¡åœæ‘†
è‹¥æ¶ˆæ¯æ˜¯æŒä¹…åŒ–çš„ï¼ˆpersistentï¼‰ï¼ŒRabbitMQ ä¼šå°†æº¢å‡ºæ¶ˆæ¯å†™å…¥ç£ç›˜ã€‚å½“ç£ç›˜å‰©ä½™ç©ºé—´ä½äº 50MBï¼ˆé»˜è®¤ï¼‰ï¼Œä¼šè§¦å‘ **disk free alarm**ï¼ŒRabbitMQ ä¼šè¿›å…¥â€œåªè¯»æ¨¡å¼â€â€”â€”**å®Œå…¨æ‹’ç»æ–°æ¶ˆæ¯å‘å¸ƒ**ï¼Œæ‰€æœ‰ç”Ÿäº§è€…æŠ¥é”™ï¼Œç³»ç»Ÿç˜«ç—ªã€‚

#### 1.1.3 å¯åŠ¨é›ªå´©ï¼šæ¶ˆè´¹ç«¯è¢«å‹å®
å½“æ¶ˆè´¹ç«¯æ¢å¤æ—¶ï¼Œé¢å¯¹ç™¾ä¸‡çº§ç§¯å‹æ¶ˆæ¯ï¼Œç¬é—´æ‹‰å–ã€å¤„ç†ã€ACKï¼ŒCPUã€ç½‘ç»œã€æ•°æ®åº“å…¨éƒ¨è¢«æ‰“çˆ†ï¼Œå¼•å‘è¿é”æ•…éšœã€‚

> ğŸ’¡ **ç»“è®ºï¼šä¸è®¾é™çš„é˜Ÿåˆ— = æ½œåœ¨ç‚¸å¼¹ã€‚**

---

## 2. x-max-length æ˜¯ä»€ä¹ˆï¼Ÿå®ƒçœŸèƒ½é˜²çˆ†ä»“å—ï¼Ÿ

### 2.1 RabbitMQ çš„â€œè‡ªåŠ¨é™æµâ€æœºåˆ¶

RabbitMQ æä¾›äº†ä¸€ä¸ªåä¸º `x-max-length` çš„é˜Ÿåˆ—å‚æ•°ï¼Œç”¨äºé™åˆ¶é˜Ÿåˆ—ä¸­æœ€å¤šå®¹çº³çš„æ¶ˆæ¯æ•°é‡ã€‚

- **ç±»å‹**ï¼šæ•´æ•°ï¼ˆintegerï¼‰
- **ä½œç”¨**ï¼šå½“é˜Ÿåˆ—æ¶ˆæ¯æ•°è¶…è¿‡è¯¥å€¼ï¼Œè‡ªåŠ¨ä¸¢å¼ƒ**æœ€æ—§**çš„ä¸€æ¡æ¶ˆæ¯ï¼Œä¸ºæ–°æ¶ˆæ¯è…¾å‡ºç©ºé—´ã€‚
- **ç­–ç•¥**ï¼šFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰â€”â€”ä¸¢å¼ƒæœ€æ—©è¿›å…¥çš„ï¼Œä¿ç•™æœ€æ–°æ¶ˆæ¯ï¼Œç¬¦åˆå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ã€‚

#### 2.1.1 ä¸¾ä¸ªä¾‹å­ï¼šè®¾ç½® x-max-length: 5

| æ—¶é—´ | æ¶ˆæ¯åºåˆ— | é˜Ÿåˆ—çŠ¶æ€ |
|------|----------|----------|
| T1   | msg1     | [msg1] |
| T2   | msg2     | [msg1, msg2] |
| T3   | msg3     | [msg1, msg2, msg3] |
| T4   | msg4     | [msg1, msg2, msg3, msg4] |
| T5   | msg5     | [msg1, msg2, msg3, msg4, msg5] |
| T6   | msg6     | [msg2, msg3, msg4, msg5, msg6] â† **msg1 è¢«ä¸¢å¼ƒ** |

âœ… **æ•ˆæœ**ï¼šé˜Ÿåˆ—å§‹ç»ˆç»´æŒ 5 æ¡ï¼Œ**ç”Ÿäº§è€…æ— æ„ŸçŸ¥**ï¼Œ**ä¸ä¼šæŠ¥é”™**ã€‚

#### 2.1.2 å®ƒèƒ½å’ŒæŒä¹…åŒ–å…±å­˜å—ï¼Ÿ

å¯ä»¥ï¼å³ä½¿ä½ è®¾ç½®äº† `durable=true` å’Œæ¶ˆæ¯ `delivery_mode=2`ï¼ˆæŒä¹…åŒ–ï¼‰ï¼Œ`x-max-length` ä¾ç„¶ä¼šä¼˜å…ˆç”Ÿæ•ˆã€‚  
**æŒä¹…åŒ– â‰  ä¸ä¸¢å¼ƒ**ã€‚RabbitMQ è®¤ä¸ºâ€œç¨³å®šæ€§ > æ•°æ®å®Œæ•´æ€§â€â€”â€”å®å¯ä¸¢æ—§æ¶ˆæ¯ï¼Œä¹Ÿä¸è®©æœåŠ¡å´©æºƒã€‚

> âœ… **x-max-length æ˜¯ä¿éšœç³»ç»Ÿå¯ç”¨æ€§çš„â€œç†”æ–­å™¨â€**ï¼Œä¸æ˜¯â€œæ•°æ®ä¿é™©ç®±â€ã€‚

---

## 3. ä¸ºä»€ä¹ˆä½ è®¾ç½®çš„ x-max-length æ— æ•ˆï¼Ÿ

### 3.1 æœ€è‡´å‘½çš„è¯¯åŒºï¼šä½ ä»¥ä¸ºâ€œç¼–è¾‘é˜Ÿåˆ—â€èƒ½æ”¹å‚æ•°

åœ¨ RabbitMQ ç®¡ç†ç•Œé¢ï¼ˆWeb UIï¼‰ä¸­ï¼Œä½ ç‚¹å‡»æŸä¸ªé˜Ÿåˆ— â†’ â€œEditâ€ â†’ åœ¨ Arguments é‡Œå¡«å…¥ `x-max-length: 1000` â†’ ç‚¹å‡» â€œUpdate queueâ€ â†’ ç³»ç»Ÿæç¤º â€œQueue updated successfullyâ€ã€‚

**ä½ ä»¥ä¸ºæˆåŠŸäº†ï¼Ÿå…¶å®ï¼Œä½ è¢« UI æ¬ºéª—äº†ã€‚**

#### 3.1.1 RabbitMQ çš„ç¡¬æ€§è§„åˆ™ï¼šarguments æ˜¯â€œå£°æ˜æ—¶â€çš„åªè¯»å±æ€§

- RabbitMQ åœ¨**é˜Ÿåˆ—é¦–æ¬¡åˆ›å»º**æ—¶ï¼Œè¯»å–å¹¶å›ºåŒ–æ‰€æœ‰ `arguments`ï¼ˆåŒ…æ‹¬ `x-max-length`, `x-message-ttl`, `x-dead-letter-exchange`ï¼‰ã€‚
- **ä¹‹åæ‰€æœ‰â€œç¼–è¾‘â€æ“ä½œï¼Œéƒ½ä¼šå¿½ç•¥è¿™äº›å‚æ•°**ï¼Œä¸ä¼šæ›´æ–°ã€‚
- ä½ çœ‹åˆ°çš„â€œæ›´æ–°æˆåŠŸâ€ï¼Œåªæ˜¯ä¿®æ”¹äº† `durable`ã€`auto-delete` ç­‰å¯å˜å­—æ®µï¼Œ**å¯¹ arguments çš„ä¿®æ”¹æ˜¯é™é»˜å¤±è´¥çš„**ã€‚

> ğŸš« å®˜æ–¹æ–‡æ¡£æ˜ç¡®è¯´æ˜ï¼š  
> â€œArguments such as `x-max-length` cannot be changed after queue creation.â€  
> â€”â€” [RabbitMQ Queue Properties](https://www.rabbitmq.com/queues.html)

#### 3.1.2 å¦‚ä½•éªŒè¯ä½ çœŸçš„æ²¡ç”Ÿæ•ˆï¼Ÿ

æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š

```bash
curl -u guest:guest http://localhost:15672/api/queues/%2F/your-queue-name
```

æŸ¥çœ‹è¿”å› JSON ä¸­çš„ `arguments` å­—æ®µï¼š

```json
{
  "name": "your-queue-name",
  "vhost": "/",
  "messages": 1500,
  "arguments": {}  // ğŸ‘ˆ ç©ºï¼ä½ è®¾ç½®çš„ x-max-length æ ¹æœ¬ä¸å­˜åœ¨ï¼
}
```

æˆ–è€…åœ¨ Web UI çš„â€œArgumentsâ€è¡¨æ ¼ä¸­ï¼Œå‘ç°ä½ å¡«çš„ `x-max-length` **æ ¹æœ¬æ²¡å‡ºç°**ã€‚

> ğŸ”¥ **çœŸç›¸ï¼šä½ è®¾ç½®çš„å‚æ•°ä»æœªè¢«åº”ç”¨ï¼Œåªæ˜¯è¢«ç³»ç»Ÿå¿½ç•¥äº†ã€‚**

---

## 4. æ­£ç¡®ä½¿ç”¨ x-max-length çš„ç»ˆææŒ‡å—

### 4.1 æ–¹æ³•ä¸€ï¼šåˆ é™¤é‡å»ºï¼ˆæ¨èï¼ï¼‰

è¿™æ˜¯å”¯ä¸€å¯é ã€å®˜æ–¹æ”¯æŒçš„æ–¹å¼ã€‚

#### 4.1.1 æ“ä½œæ­¥éª¤ï¼ˆWeb UIï¼‰

| æ­¥éª¤ | æ“ä½œ |
|------|------|
| 1ï¸âƒ£ | **å¤‡ä»½**ï¼ˆå¦‚éœ€ï¼‰ï¼šå¯¼å‡ºæ¶ˆæ¯æˆ–è®°å½•ç§¯å‹é‡ |
| 2ï¸âƒ£ | ç‚¹å‡»é˜Ÿåˆ—å³ä¾§çš„ **â€œDeleteâ€** â†’ ç¡®è®¤åˆ é™¤ï¼ˆâš ï¸ æ­¤æ“ä½œä¼šæ¸…ç©ºæ‰€æœ‰æ¶ˆæ¯ï¼‰ |
| 3ï¸âƒ£ | ç‚¹å‡»é¡¶éƒ¨èœå• **â€œQueuesâ€ â†’ â€œAdd a new queueâ€** |
| 4ï¸âƒ£ | è¾“å…¥é˜Ÿåˆ—åç§°ï¼ˆä¸åŸåä¸€è‡´ï¼‰ |
| 5ï¸âƒ£ | åœ¨ **â€œArgumentsâ€** åŒºåŸŸç‚¹å‡» **â€œAdd new argumentâ€**ï¼Œå¡«å†™ï¼š |

| Key | Type | Value |
|-----|------|-------|
| `x-max-length` | integer | `1000` |
| `x-max-length-bytes` | integer | `52428800`ï¼ˆ50MBï¼Œå¯é€‰ï¼‰ |
| `x-dead-letter-exchange` | string | `dlx.exchange`ï¼ˆæ¨èï¼Œè§ä¸‹æ–‡ï¼‰ |
| `x-dead-letter-routing-key` | string | `dead.letter`ï¼ˆæ¨èï¼‰ |

| 6ï¸âƒ£ | ç‚¹å‡» **â€œAdd queueâ€** åˆ›å»ºæ–°é˜Ÿåˆ— |
| 7ï¸âƒ£ | é‡æ–°ç»‘å®šäº¤æ¢æœºï¼ˆBindingsï¼‰å’Œæƒé™ï¼ˆå¦‚éœ€ï¼‰ |

âœ… **ç°åœ¨æµ‹è¯•**ï¼šå‘å¸ƒ 1001 æ¡æ¶ˆæ¯ï¼Œé˜Ÿåˆ—å°†ç¨³å®šåœ¨ 1000 æ¡ï¼Œ`Discards` ç»Ÿè®¡å€¼å¢åŠ  1ã€‚

> âœ… **ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ** å› ä¸ºè¿™æ˜¯**é¦–æ¬¡å£°æ˜**ï¼ŒRabbitMQ æ­£ç¡®è¯»å–äº†ä½ çš„å‚æ•°ã€‚

#### 4.1.2 ä¸ºä»€ä¹ˆæ¨èåŠ  x-max-length-bytesï¼Ÿ

å¦‚æœä½ çš„æ¶ˆæ¯ä½“å¾ˆå¤§ï¼ˆå¦‚æ—¥å¿—ã€å›¾ç‰‡ã€JSON æŠ¥æ–‡ï¼‰ï¼Œä»…é™åˆ¶æ•°é‡ä¸å¤Ÿã€‚  
ä¾‹å¦‚ï¼š1000 æ¡ 10MB çš„æ¶ˆæ¯ = 10GB ç£ç›˜å ç”¨ â†’ ä¾ç„¶ä¼šçˆ†ç›˜ã€‚

```text
x-max-length-bytes: 52428800   # 50MB
```

RabbitMQ ä¼šåŒæ—¶æ£€æŸ¥**æ•°é‡**å’Œ**å­—èŠ‚æ•°**ï¼Œä»»ä¸€è¶…é™å°±ä¸¢å¼ƒæœ€æ—§æ¶ˆæ¯ã€‚

---

### 4.2 æ–¹æ³•äºŒï¼šç”¨ä»£ç /è„šæœ¬å£°æ˜ï¼ˆç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µï¼‰

ä¸è¦ä¾èµ– Web UI åˆ›å»ºé˜Ÿåˆ—ï¼ç”¨ä»£ç æˆ–è„šæœ¬å£°æ˜ï¼Œæ‰èƒ½ä¿è¯é…ç½®å¯è¿½è¸ªã€å¯ç‰ˆæœ¬æ§åˆ¶ã€‚

#### 4.2.1 Python (pika) ç¤ºä¾‹

```python
import pika

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

channel.queue_declare(
    queue='order_queue',
    durable=True,
    arguments={
        'x-max-length': 1000,
        'x-max-length-bytes': 52428800,
        'x-dead-letter-exchange': 'dlx.exchange',
        'x-dead-letter-routing-key': 'dead.letter'
    }
)
```

#### 4.2.2 Spring Boot (Java) ç¤ºä¾‹

```yaml
spring:
  rabbitmq:
    listener:
      simple:
        acknowledge-mode: manual
        prefetch: 1

# é˜Ÿåˆ—é…ç½®é€šè¿‡ @Bean å®šä¹‰
@Bean
public Queue orderQueue() {
    return QueueBuilder.durable("order_queue")
        .maxLength(1000)
        .maxLengthBytes(52428800)
        .deadLetterExchange("dlx.exchange")
        .deadLetterRoutingKey("dead.letter")
        .build();
}
```

#### 4.2.3 ä½¿ç”¨ rabbitmqadmin å‘½ä»¤è¡Œï¼ˆè¿ç»´æ¨èï¼‰

```bash
rabbitmqadmin declare queue name=order_queue \
  arguments='{"x-max-length":1000,"x-max-length-bytes":52428800,"x-dead-letter-exchange":"dlx.exchange","x-dead-letter-routing-key":"dead.letter"}'
```

> âœ… **ä¼˜åŠ¿**ï¼šå¯å†™å…¥ CI/CD æµæ°´çº¿ï¼Œéƒ¨ç½²å³ç”Ÿæ•ˆï¼Œé¿å…äººä¸ºå¤±è¯¯ã€‚

---

## 5. å¼ºçƒˆæ¨èï¼šæ­é…æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰å®ç°â€œä¼˜é›…é™çº§â€

### 5.1 ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—ï¼Ÿ

å½“æ¶ˆæ¯è¢«**ä¸¢å¼ƒ**ï¼ˆå›  `x-max-length`ï¼‰ã€**è¿‡æœŸ**ï¼ˆTTLï¼‰æˆ–**æ‹’ç»ä¸”ä¸é‡å…¥é˜Ÿ**æ—¶ï¼ŒRabbitMQ å¯å°†å…¶è·¯ç”±åˆ°å¦ä¸€ä¸ªé˜Ÿåˆ— â€”â€” ç§°ä¸ºâ€œæ­»ä¿¡é˜Ÿåˆ—â€ã€‚

### 5.2 ä¸ºä»€ä¹ˆå¿…é¡»ç”¨ï¼Ÿ

- `x-max-length` ä¸¢å¼ƒæ¶ˆæ¯æ—¶ï¼Œ**é»˜è®¤æ— å£°æ— æ¯**ã€‚
- å¦‚æœä½ ä¸ç›‘æ§ï¼Œä½ æ°¸è¿œä¸çŸ¥é“æœ‰å¤šå°‘æ¶ˆæ¯è¢«ä¸¢æ‰ï¼Œä¸šåŠ¡æ˜¯å¦å—æŸã€‚

#### 5.2.1 é…ç½®ç¤ºä¾‹ï¼ˆWeb UIï¼‰

| Key | Value |
|-----|-------|
| `x-dead-letter-exchange` | `dlx.exchange` |
| `x-dead-letter-routing-key` | `dead.letter` |

ç„¶ååˆ›å»ºä¸€ä¸ªäº¤æ¢æœº `dlx.exchange`ï¼ˆç±»å‹ï¼šdirectï¼‰ï¼Œå¹¶ç»‘å®šä¸€ä¸ªé˜Ÿåˆ— `dead_letter_queue`ã€‚

#### 5.2.2 ç›‘æ§ä¸å‘Šè­¦

- ç”¨ Prometheus ç›‘æ§ `rabbitmq_queue_messages_ready{queue="dead_letter_queue"}`ã€‚
- å½“è¯¥é˜Ÿåˆ—æ¶ˆæ¯ > 5ï¼Œå‘é€é’‰é’‰/ä¼ä¸šå¾®ä¿¡å‘Šè­¦ï¼š
  > â€œè®¢å•é˜Ÿåˆ—å·²ä¸¢å¼ƒ 120 æ¡æ¶ˆæ¯ï¼è¯·æ£€æŸ¥æ¶ˆè´¹ç«¯ï¼â€

#### 5.2.3 äººå·¥å¹²é¢„

- æ‰‹åŠ¨æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—ï¼Œåˆ†æè¢«ä¸¢å¼ƒæ¶ˆæ¯å†…å®¹ã€‚
- é‡æ”¾å…³é”®æ¶ˆæ¯ï¼ˆå¦‚æ”¯ä»˜è®¢å•ï¼‰ï¼Œæˆ–è®°å½•æ—¥å¿—ç”¨äºäº‹åå®¡è®¡ã€‚

> âœ… **è¿™æ‰æ˜¯â€œé«˜å¯ç”¨â€çš„çœŸæ­£ä½“ç°ï¼šä¸æ˜¯ä¸ä¸¢æ¶ˆæ¯ï¼Œè€Œæ˜¯ä¸¢å¾—æœ‰è¿¹å¯å¾ªã€‚**

---

## 6. é¿å‘æ€»ç»“ï¼šRabbitMQ é˜Ÿåˆ—é…ç½® Checklist

| æ£€æŸ¥é¡¹ | æ˜¯å¦å®Œæˆ | è¯´æ˜ |
|--------|----------|------|
| âœ… é˜Ÿåˆ—æ˜¯å¦è®¾ç½®äº† `x-max-length`ï¼Ÿ | âš ï¸ å¿…é¡» | é˜²æ­¢æ— é™å †ç§¯ |
| âœ… æ˜¯å¦è®¾ç½®äº† `x-max-length-bytes`ï¼Ÿ | âœ… æ¨è | é˜²æ­¢å¤§æ¶ˆæ¯æ’‘çˆ†ç£ç›˜ |
| âœ… æ˜¯å¦ä½¿ç”¨äº† `x-dead-letter-exchange`ï¼Ÿ | âœ… å¼ºçƒˆæ¨è | ä¸¢å¼ƒæ¶ˆæ¯å¯è¿½è¸ª |
| âœ… æ˜¯å¦é€šè¿‡ä»£ç /è„šæœ¬åˆ›å»ºé˜Ÿåˆ—ï¼Ÿ | âœ… ç”Ÿäº§ç¯å¢ƒå¿…é¡» | é¿å… Web UI è¯¯æ“ä½œ |
| âœ… æ˜¯å¦ç›‘æ§ `Discards` å’Œ `dead_letter_queue`ï¼Ÿ | âœ… å¿…é¡» | å‘Šè­¦æ¯”ä¿®å¤æ›´é‡è¦ |
| âŒ æ˜¯å¦ä¾èµ–â€œç¼–è¾‘é˜Ÿåˆ—â€ä¿®æ”¹å‚æ•°ï¼Ÿ | âŒ ç»å¯¹ç¦æ­¢ | å‚æ•°ä¸ä¼šç”Ÿæ•ˆï¼ |

---

## 7. å¸¸è§é—®é¢˜ FAQ

### 7.1 æˆ‘èƒ½ä¿®æ”¹å·²æœ‰é˜Ÿåˆ—çš„ x-max-length å—ï¼Ÿ

> **ä¸èƒ½ã€‚** é™¤éåˆ é™¤é‡å»ºã€‚è¿™æ˜¯ RabbitMQ çš„è®¾è®¡ï¼Œä¸æ˜¯ bugã€‚

### 7.2 ä¸¢å¼ƒçš„æ¶ˆæ¯è¿˜èƒ½æ¢å¤å—ï¼Ÿ

> **ä¸èƒ½ã€‚** ä¸€æ—¦è¢«ä¸¢å¼ƒï¼Œå°±æ°¸ä¹…æ¶ˆå¤±ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¿…é¡»æ­é…æ­»ä¿¡é˜Ÿåˆ—ã€‚

### 7.3 è®¾ç½®å¤ªå°ï¼Œä¼šä¸ä¼šè¯¯ä¸¢é‡è¦æ¶ˆæ¯ï¼Ÿ

> ä¼šã€‚å»ºè®®æ ¹æ®ä¸šåŠ¡å³°å€¼é¢„ä¼°ï¼š  
> - æ—¥å‡è®¢å• 5000 æ¡ â†’ è®¾ `x-max-length: 10000`  
> - å³°å€¼ 10 åˆ†é’Ÿå†… 8000 æ¡ â†’ è®¾ `x-max-length: 15000`  
> å¹¶é…åˆå‘Šè­¦ï¼Œè®©è¿ç»´åœ¨ç§¯å‹ 8000 æ—¶å°±ä»‹å…¥ã€‚

### 7.4 ä¸ºä»€ä¹ˆç®¡ç†ç•Œé¢è¿˜æä¾›â€œUpdateâ€æŒ‰é’®ï¼Ÿè¿™ä¸æ˜¯è¯¯å¯¼å—ï¼Ÿ

> æ˜¯çš„ï¼Œè¿™æ˜¯ RabbitMQ UI çš„ä¸€ä¸ª**å†å²é—ç•™è®¾è®¡ç¼ºé™·**ã€‚ç¤¾åŒºå·²å¤šæ¬¡åé¦ˆï¼Œä½†å®˜æ–¹è®¤ä¸ºâ€œä¿®æ”¹å‚æ•°åº”é€šè¿‡å£°æ˜å®Œæˆâ€ï¼Œæ‰€ä»¥æœªä¿®å¤ã€‚  
> **è¯·è®°ä½ï¼šWeb UI çš„â€œEditâ€æŒ‰é’®ï¼Œåªæ”¹ `durable` å’Œ `auto-delete`ï¼Œä¸æ”¹ argumentsã€‚**

---

## ç»“è¯­ï¼šè®©ç³»ç»Ÿâ€œä¼˜é›…åœ°å¤±è´¥â€ï¼Œè€Œä¸æ˜¯â€œæ²‰é»˜åœ°å´©æºƒâ€

RabbitMQ ä¸æ˜¯â€œä¸‡èƒ½èƒ¶â€ï¼Œå®ƒæ˜¯ä¸€ä¸ª**é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æ¶ˆæ¯ä¸­é—´ä»¶**ï¼Œå®ƒçš„å“²å­¦æ˜¯ï¼š

> **å®å¯ä¸¢æ‰æ—§æ¶ˆæ¯ï¼Œä¹Ÿä¸èƒ½è®©æ•´ä¸ªç³»ç»Ÿåœæ‘†ã€‚**

`x-max-length` æ˜¯ä½ æ‰‹ä¸­æœ€é”‹åˆ©çš„â€œç†”æ–­å™¨â€ã€‚  
ä½†åªæœ‰å½“ä½ **æ­£ç¡®ä½¿ç”¨å®ƒ**ï¼Œå¹¶**æ­é…æ­»ä¿¡é˜Ÿåˆ—ç›‘æ§**ï¼Œå®ƒæ‰èƒ½çœŸæ­£ä¿æŠ¤ä½ çš„ç³»ç»Ÿã€‚

> ğŸš« åˆ«å†ç›¸ä¿¡â€œç¼–è¾‘é˜Ÿåˆ—â€èƒ½æ”¹å‚æ•°ã€‚  
> âœ… åˆ é™¤é‡å»ºï¼Œæ‰æ˜¯å”¯ä¸€æ­£è§£ã€‚  
> ğŸ”” ç›‘æ§æ­»ä¿¡é˜Ÿåˆ—ï¼Œæ‰æ˜¯é«˜å¯ç”¨çš„åº•çº¿ã€‚

---

**ğŸ“Œ é™„ï¼šä¸€é”®åˆ›å»ºå®‰å…¨é˜Ÿåˆ—çš„å‘½ä»¤ï¼ˆå¤åˆ¶å³ç”¨ï¼‰**

```bash
rabbitmqadmin declare queue name=my_queue \
  arguments='{"x-max-length":1000,"x-max-length-bytes":52428800,"x-dead-letter-exchange":"dlx.exchange","x-dead-letter-routing-key":"dead.letter"}'
```

**ğŸ“Œ é™„ï¼šPrometheus ç›‘æ§æŒ‡æ ‡ï¼ˆGrafana å‘Šè­¦è§„åˆ™ï¼‰**

```promql
# æ¶ˆæ¯ä¸¢å¼ƒå‘Šè­¦
rabbitmq_queue_messages_discarded{queue="my_queue"} > 0

# æ­»ä¿¡é˜Ÿåˆ—ç§¯å‹å‘Šè­¦
rabbitmq_queue_messages_ready{queue="dead_letter_queue"} > 5
```

---

> ğŸ“š æ¨èé˜…è¯»ï¼š[RabbitMQ å®˜æ–¹é˜Ÿåˆ—æ–‡æ¡£](https://www.rabbitmq.com/queues.html)  

